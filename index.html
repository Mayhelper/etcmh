<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä MML –æ—Ç—á–µ—Ç–æ–≤ - –§–∏–ª—å—Ç—Ä –ø–æ –∑–∞–ª–∏–≤–∫–µ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 30px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eaeaea;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
            font-size: 0.95em;
        }

        .upload-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px dashed #3498db;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #2980b9;
            background: #f0f7ff;
        }

        .file-input-wrapper {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .file-label {
            background: #3498db;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
            font-weight: 500;
        }

        .file-label:hover {
            background: #2980b9;
        }

        .file-name {
            color: #2c3e50;
            font-style: italic;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
            flex-grow: 1;
            min-width: 200px;
        }

        input[type="file"] {
            display: none;
        }

        .search-section {
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #eaeaea;
        }

        .search-input-wrapper {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex-grow: 1;
            padding: 14px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            min-width: 300px;
            text-transform: uppercase;
        }

        .search-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .search-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }

        .search-btn:hover {
            background: #27ae60;
        }

        .search-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .results-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eaeaea;
        }

        .results-title {
            font-size: 1.5em;
            color: #2c3e50;
        }

        .results-count {
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .tt-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .info-item {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 4px;
            border: 1px solid #eaeaea;
            margin-bottom: 6px;
        }

        .info-label {
            font-size: 0.85em;
            color: #7f8c8d;
            font-weight: 500;
            flex-shrink: 0;
            margin-right: 10px;
        }

        .info-value {
            font-weight: 500;
            color: #2c3e50;
            font-size: 0.9em;
            text-align: right;
            word-break: break-word;
        }

        .filter-options-container {
            margin-bottom: 20px;
            padding: 0;
        }

        .sku-table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #eaeaea;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .sku-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        .sku-table th {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 500;
            position: sticky;
            top: 0;
        }

        .sku-table tr {
            border-bottom: 1px solid #eaeaea;
            transition: background 0.2s;
        }

        .sku-table tr:hover {
            background: #f8f9fa;
        }

        .sku-table td {
            padding: 12px 15px;
        }

        .sku-name {
            font-weight: 500;
            color: #2c3e50;
        }

        .sku-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .status-green-fill {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-no-fill {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-green-fill .status-icon {
            background: #28a745;
        }

        .status-no-fill .status-icon {
            background: #dc3545;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .no-results-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .error-message {
            background: #ffeaea;
            color: #e74c3c;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #e74c3c;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #3498db;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .filter-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-options .results-count {
            margin-left: auto;
            margin-bottom: 0;
        }

        .filter-options .results-count {
            margin-left: auto;
            margin-bottom: 0;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .filter-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .file-input-wrapper,
            .search-input-wrapper {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input,
            .file-name {
                min-width: unset;
                width: 100%;
            }
            
            h1 {
                font-size: 1.8em;
            }

            .tt-info {
                padding: 12px;
                margin-bottom: 15px;
            }

            .info-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 6px 10px;
                margin-bottom: 4px;
            }

            .info-label {
                font-size: 0.8em;
                margin-bottom: 2px;
                margin-right: 0;
            }

            .info-value {
                font-size: 0.85em;
                text-align: left;
            }

            .filter-options-container {
                margin-bottom: 15px;
            }

            .filter-options {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                width: 100%;
            }

            .filter-btn {
                flex: 1;
                min-width: 120px;
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .filter-options .results-count {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
                text-align: center;
            }

            .results-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .results-count {
                align-self: flex-end;
            }

            .sku-table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .sku-table {
                font-size: 0.85em;
                width: 100%;
                min-width: unset;
            }

            .sku-table th {
                padding: 8px 6px;
                font-size: 0.8em;
            }

            .sku-table td {
                padding: 8px 6px;
                font-size: 0.85em;
                word-wrap: break-word;
                word-break: break-word;
            }

            .sku-name {
                font-size: 0.85em;
                white-space: normal;
                word-wrap: break-word;
                word-break: break-word;
                line-height: 1.4;
            }

            .sku-status {
                font-size: 0.8em;
                padding: 4px 8px;
            }

            .status-icon {
                width: 8px;
                height: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–§–∞–∫—Ç –ø—Ä–æ–∫—É–ø–∫–∏ MML</h1>
        </header>

        <div class="search-section">
            <div class="search-input-wrapper">
                <input type="text" 
                       id="searchInput" 
                       class="search-input" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¢–¢ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –î–ú–ü-1003991)">
                <button id="searchBtn" class="search-btn" disabled>
                    üîç –ù–∞–π—Ç–∏
                </button>
            </div>
            <div id="errorMessage" class="error-message"></div>
            <div id="loading" class="loading">
                <div class="loading-spinner"></div>
                <p>–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∑–∞–ª–∏–≤–∫—É —è—á–µ–µ–∫...</p>
            </div>
        </div>

        <div id="resultsSection" class="results-section">
            <div class="results-header">
                <h2 class="results-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
            </div>

            <div class="tt-info">
                <div style="margin-bottom: 10px;">
                    <strong style="font-size: 1.1em;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–µ:</strong>
                </div>
                <div id="ttInfoContent">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <div class="filter-options-container">
                <div class="filter-options">
                    <button class="filter-btn active" data-filter="mml">–ü–ª–∞–Ω MML</button>
                    <button class="filter-btn" data-filter="plus">–ü—Ä–æ–∫—É–ø–ª–µ–Ω–Ω—ã–µ MML</button>
                    <div class="results-count" id="resultsCount">0 SKU</div>
                </div>
            </div>

            <div class="sku-table-container">
                <table class="sku-table" id="skuTable">
                    <thead>
                        <tr>
                            <th style="width: 70%;">–ù–∞–∑–≤–∞–Ω–∏–µ SKU</th>
                            <th style="width: 15%;">–ü–ª–∞–Ω–æ–≤—ã–π MML</th>
                            <th style="width: 15%;">–ü—Ä–æ–∫—É–ø–∫–∞</th>
                        </tr>
                    </thead>
                    <tbody id="skuTableBody">
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="noResults" class="no-results" style="display: none;">
            <div class="no-results-icon">üîç</div>
            <p>–¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>
            <p style="font-size: 0.9em; margin-top: 10px;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –¢–¢</p>
        </div>

        <footer>
            <p>(c) –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –æ—Ç–¥–µ–ª–æ–º –û–†–ü–ü –≤ 2025–≥. –í—Å–µ –ø—Ä–∞–≤–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –ú–ê–ô.</p>
        </footer>
    </div>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–≤–µ—Ç–∞–º–∏ Excel -->
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <script>
        let workbook = null;
        let worksheet = null;
        let headers = [];
        let dataRows = [];
        let skuStartIndex = null;
        let currentFilter = 'mml';
        let currentRowData = null;
        let allSkuData = [];

        // –ö–æ–ª–æ–Ω–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        const infoColumns = [
            { key: 'territoryCode', display: '–ö–æ–¥ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏', search: ['–ö–æ–¥ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏'] },
            { key: 'tp', display: '–¢–ü', search: ['–¢–ü'] },
            { key: 'ttCode', display: '–ö–æ–¥ –¢–¢', search: ['–ö–æ–¥ –¢–¢'] },
            { key: 'ttName', display: '–ù–∞–∑–≤–∞–Ω–∏–µ –¢–¢', search: ['–ù–∞–∑–≤–∞–Ω–∏–µ –¢–¢'] },
            { key: 'address', display: '–ê–¥—Ä–µ—Å', search: ['–ê–¥—Ä–µ—Å'] },
            { key: 'ttType', display: '–¢–∏–ø –¢–¢', search: ['–¢–∏–ø –¢–¢'] },
            { key: 'ttChannel', display: '–ö–∞–Ω–∞–ª –¢–¢', search: ['–ö–∞–Ω–∞–ª –¢–¢', '–ö–∞–Ω–∞–ª', '–ö–∞–Ω–∞–ª<br>–¢–¢', '–ö–∞–Ω–∞–ª<br/>–¢–¢'] },
            { key: 'planTea', display: '–ü–ª–∞–Ω MML –ß–∞–π', search: ['–ü–ª–∞–Ω MML –ß–∞–π', '–ü–ª–∞–Ω  MML –ß–∞–π'] },
            { key: 'factTeaQty', display: '–§–∞–∫—Ç MML –ß–∞–π (–∫–æ–ª-–≤–æ)', search: ['–§–∞–∫—Ç MML –ß–∞–π (–∫–æ–ª-–≤–æ)', '–§–∞–∫—Ç MML –ß–∞–π <br>(–∫–æ–ª-–≤–æ)', '–§–∞–∫—Ç MML –ß–∞–π<br>(–∫–æ–ª-–≤–æ)', '–§–∞–∫—Ç MML –ß–∞–π', '–∫–æ–ª-–≤–æ'] },
            { key: 'factTeaPercent', display: '–§–∞–∫—Ç MML –ß–∞–π%', search: ['–§–∞–∫—Ç MML –ß–∞–π%', '–§–∞–∫—Ç MML –ß–∞–π %', 'MML –ß–∞–π%'] },
            { key: 'completion', display: '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ MML –ß–ê–ô', search: ['–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ MML –ß–ê–ô', '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ<br>MML –ß–ê–ô', '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ<br/>MML –ß–ê–ô', '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ MML'] },
            { key: 'includeSDO', display: '–í–∫–ª—é—á–∞—Ç—å –≤ —Ä–∞—Å—á—ë—Ç SDO', search: ['–í–∫–ª—é—á–∞—Ç—å –≤ —Ä–∞—Å—á—ë—Ç SDO'] }
        ];

        // URL —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö
        const DATA_FILE_URL = 'https://raw.githubusercontent.com/Mayhelper/mayhelper/main/datamml.xlsx';

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadFileFromServer() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('errorMessage').style.display = 'none';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª —Å —Å–µ—Ä–≤–µ—Ä–∞
                const response = await fetch(DATA_FILE_URL);
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ${response.status} ${response.statusText}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                const data = new Uint8Array(arrayBuffer);
                
                // –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª —Å –æ–ø—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∏–ª–∏
                workbook = XLSX.read(data, { 
                    type: 'array',
                    cellStyles: true,  // –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∏–ª–∏
                    cellHTML: true     // –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                });
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Å—Ç–∞
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                worksheet = firstSheet;
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–∞ –º–∞—Å—Å–∏–≤–æ–≤
                const sheetData = XLSX.utils.sheet_to_json(firstSheet, { 
                    header: 1,
                    raw: false,
                    defval: ''
                });
                
                // –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (—Å—Ç—Ä–æ–∫–∞ 4, –∏–Ω–¥–µ–∫—Å 3)
                if (sheetData.length >= 4) {
                    headers = sheetData[3]; // –°—Ç—Ä–æ–∫–∞ 4 (–∏–Ω–¥–µ–∫—Å 3)
                    
                    // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å —Å—Ç–æ–ª–±—Ü–∞ "–í–∫–ª—é—á–∞—Ç—å –≤ —Ä–∞—Å—á—ë—Ç SDO"
                    const sdoIndex = findColumnIndex(['–í–∫–ª—é—á–∞—Ç—å –≤ —Ä–∞—Å—á—ë—Ç SDO']);
                    
                    if (sdoIndex !== -1) {
                        skuStartIndex = sdoIndex + 1;
                        
                        // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏
                        dataRows = [];
                        for (let i = 4; i < sheetData.length; i++) {
                            const row = sheetData[i];
                            if (row && row.length > 0) {
                                dataRows.push(row);
                            }
                        }
                        
                        console.log('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω. –ù–∞–π–¥–µ–Ω–æ —Å—Ç—Ä–æ–∫:', dataRows.length);
                        console.log('SKU –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –∫–æ–ª–æ–Ω–∫–∏:', skuStartIndex);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
                        showFileInfo();
                        
                        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∏—Å–∫–∞
                        document.getElementById('searchBtn').disabled = false;
                        
                    } else {
                        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–æ–ª–æ–Ω–∫—É "–í–∫–ª—é—á–∞—Ç—å –≤ —Ä–∞—Å—á—ë—Ç SDO"');
                    }
                } else {
                    showError('–§–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö');
                }
                
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ' + error.message);
                document.getElementById('loading').style.display = 'none';
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadFileFromServer();
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ –∫–æ–ª–æ–Ω–∫–∏
        function findColumnIndex(searchTerms) {
            for (let i = 0; i < headers.length; i++) {
                let header = headers[i] ? headers[i].toString().trim() : '';
                // –£–±–∏—Ä–∞–µ–º HTML —Ç–µ–≥–∏ –∏ –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
                header = header.replace(/<br\s*\/?>/gi, ' ').replace(/\s+/g, ' ').trim();
                
                for (const term of searchTerms) {
                    // –¢–∞–∫–∂–µ —É–±–∏—Ä–∞–µ–º HTML —Ç–µ–≥–∏ –∏–∑ –∏—Å–∫–æ–º–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞
                    const cleanTerm = term.replace(/<br\s*\/?>/gi, ' ').replace(/\s+/g, ' ').trim();
                    if (header.includes(cleanTerm) || cleanTerm.includes(header)) {
                        return i;
                    }
                }
            }
            return -1;
        }

        // –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É –¢–¢
        document.getElementById('searchBtn').addEventListener('click', searchByTT);
        
        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', function(e) {
            const cursorPosition = this.selectionStart;
            this.value = this.value.toUpperCase();
            this.setSelectionRange(cursorPosition, cursorPosition);
        });
        
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchByTT();
            }
        });

        function searchByTT() {
            const searchCode = document.getElementById('searchInput').value.trim();
            if (!searchCode) {
                showError('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¢–¢ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                return;
            }

            if (!workbook) {
                showError('–§–∞–π–ª –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...');
                return;
            }

            document.getElementById('loading').style.display = 'block';

            // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –∫–æ–ª–æ–Ω–∫–∏ "–ö–æ–¥ –¢–¢"
            const ttCodeIndex = findColumnIndex(['–ö–æ–¥ –¢–¢']);
            if (ttCodeIndex === -1) {
                showError('–ù–µ –Ω–∞–π–¥–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ "–ö–æ–¥ –¢–¢" –≤ —Ñ–∞–π–ª–µ');
                document.getElementById('loading').style.display = 'none';
                return;
            }

            // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –Ω—É–∂–Ω—ã–º –∫–æ–¥–æ–º –¢–¢
            let foundRowIndex = -1;
            currentRowData = null;
            
            for (let i = 0; i < dataRows.length; i++) {
                const row = dataRows[i];
                if (row[ttCodeIndex] && row[ttCodeIndex].toString().trim() === searchCode) {
                    foundRowIndex = i;
                    currentRowData = row;
                    break;
                }
            }

            if (foundRowIndex === -1 || !currentRowData) {
                document.getElementById('resultsSection').style.display = 'none';
                document.getElementById('noResults').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
                return;
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            setTimeout(() => {
                displayResults(foundRowIndex);
                document.getElementById('loading').style.display = 'none';
            }, 100);
        }

        function displayResults(rowIndex) {
            document.getElementById('noResults').style.display = 'none';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–µ
            displayTTInfo();
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ SKU
            collectSkuData(rowIndex);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∏–ª—å—Ç—Ä
            applyFilter(currentFilter);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
            document.getElementById('resultsSection').style.display = 'block';
        }

        function displayTTInfo() {
            const ttInfoContent = document.getElementById('ttInfoContent');
            let html = '';
            
            infoColumns.forEach(col => {
                const index = findColumnIndex(col.search);
                let value = '‚Äî';
                if (index !== -1 && currentRowData && currentRowData[index] !== undefined) {
                    value = currentRowData[index].toString().trim();
                    
                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
                    if (col.key === 'factTeaPercent') {
                        // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç %, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º %
                        if (value && value !== '‚Äî' && !value.includes('%')) {
                            // –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ –∏ –¥–æ–±–∞–≤–∏—Ç—å %
                            const numValue = parseFloat(value);
                            if (!isNaN(numValue)) {
                                value = numValue + '%';
                            } else {
                                value = value + '%';
                            }
                        }
                    }
                }
                
                // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
                if (col.key === 'ttChannel' || col.key === 'factTeaQty' || col.key === 'completion' || col.key === 'factTeaPercent') {
                    console.log(`–ö–æ–ª–æ–Ω–∫–∞ "${col.display}":`, {
                        searchTerms: col.search,
                        foundIndex: index,
                        value: value,
                        headers: headers.slice(0, 30).map((h, i) => `${i}: ${h}`)
                    });
                }
                
                html += `
                    <div class="info-item">
                        <span class="info-label">${col.display}:</span>
                        <span class="info-value">${value}</span>
                    </div>
                `;
            });
            
            ttInfoContent.innerHTML = html;
        }

        function collectSkuData(rowIndex) {
            allSkuData = [];
            
            if (skuStartIndex === null || !currentRowData) return;
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω —è—á–µ–µ–∫ –∏–∑ worksheet
            const range = XLSX.utils.decode_range(worksheet['!ref']);
            
            // rowIndex - —ç—Ç–æ –∏–Ω–¥–µ–∫—Å –≤ –º–∞—Å—Å–∏–≤–µ dataRows (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0)
            // dataRows –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 5-–π —Å—Ç—Ä–æ–∫–∏ Excel (–∏–Ω–¥–µ–∫—Å 4 –≤ sheetData, –Ω–æ —Å—Ç—Ä–æ–∫–∞ 5 –≤ Excel)
            // –ü–æ—ç—Ç–æ–º—É –¥–ª—è encode_cell (–∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 0-based –∏–Ω–¥–µ–∫—Å—ã) –Ω—É–∂–Ω–æ: rowIndex + 4
            const excelRowForEncode = rowIndex + 4;
            
            for (let col = skuStartIndex; col < headers.length; col++) {
                const skuName = headers[col] ? headers[col].toString().trim() : '';
                if (!skuName) continue;
                
                const cellValue = currentRowData[col] ? currentRowData[col].toString().trim() : '';
                const hasPlus = cellValue.includes('+');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –õ–Æ–ë–û–ô –∑–∞–ª–∏–≤–∫–∏ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ü–≤–µ—Ç–∞)
                let hasFill = false;
                
                // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å —è—á–µ–π–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Excel (–Ω–∞–ø—Ä–∏–º–µ—Ä, "A5")
                // encode_cell –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 0-based –∏–Ω–¥–µ–∫—Å—ã: r=0 —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ 1 –≤ Excel
                const cellAddress = XLSX.utils.encode_cell({r: excelRowForEncode, c: col});
                const cell = worksheet[cellAddress];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞–ª–∏–≤–∫–∏ –≤ —è—á–µ–π–∫–µ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                if (cell && cell.s) {
                    const style = cell.s;
                    
                    // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—ä–µ–∫—Ç fill (–¥–∞–∂–µ –ø—É—Å—Ç–æ–π), —Å—á–∏—Ç–∞–µ–º —á—Ç–æ –∑–∞–ª–∏–≤–∫–∞ –µ—Å—Ç—å
                    // –í Excel –µ—Å–ª–∏ —è—á–µ–π–∫–∞ –∑–∞–ª–∏—Ç–∞, –æ–±—ä–µ–∫—Ç fill –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Å—Ç–∏–ª—è—Ö
                    if (style.fill) {
                        hasFill = true;
                    }
                    
                    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å—Ç–∏–ª—è
                    if (!hasFill && (style.bg || style.bgColor || style.backgroundColor)) {
                        hasFill = true;
                    }
                }
                
                // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –≤—ã–≤–æ–¥–∏–º –¥–ª—è –≤—Å–µ—Ö —è—á–µ–µ–∫ —Å–æ —Å—Ç–∏–ª—è–º–∏
                if (cell && cell.s) {
                    const hasFillStyle = !!cell.s.fill;
                    if (hasFillStyle || hasFill) {
                        console.log(`–Ø—á–µ–π–∫–∞ ${cellAddress} (${skuName}):`, {
                            hasFill: hasFill,
                            hasStyle: true,
                            hasFillStyle: hasFillStyle,
                            fill: cell.s.fill,
                            fillKeys: cell.s.fill ? Object.keys(cell.s.fill) : [],
                            fillType: cell.s.fill ? typeof cell.s.fill : 'none',
                            fillString: cell.s.fill ? JSON.stringify(cell.s.fill).substring(0, 200) : 'none',
                            value: cellValue,
                            hasPlus: hasPlus
                        });
                    }
                }
                
                allSkuData.push({
                    name: skuName,
                    value: cellValue,
                    hasPlus: hasPlus,
                    hasFill: hasFill,
                    colIndex: col
                });
            }
        }

        function applyFilter(filterType) {
            currentFilter = filterType;
            const skuTableBody = document.getElementById('skuTableBody');
            skuTableBody.innerHTML = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —Ñ–∏–ª—å—Ç—Ä–∞
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === filterType) {
                    btn.classList.add('active');
                }
            });
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            let filteredData = allSkuData;
            let filterText = '';
            
            switch(filterType) {
                case 'mml':
                    filteredData = allSkuData.filter(sku => sku.hasFill);
                    filterText = '–ü–ª–∞–Ω MML';
                    break;
                case 'plus':
                    filteredData = allSkuData.filter(sku => sku.hasPlus);
                    filterText = '–ü—Ä–æ–∫—É–ø–ª–µ–Ω–Ω—ã–µ MML';
                    break;
                default:
                    filteredData = allSkuData.filter(sku => sku.hasFill);
                    filterText = '–ü–ª–∞–Ω MML';
                    break;
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            filteredData.forEach(sku => {
                const row = document.createElement('tr');
                
                let fillStatus = '–ù–µ –ø–ª–∞–Ω–æ–≤—ã–π MML';
                let fillStatusClass = 'status-no-fill';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –ø—É—Å—Ç–æ–µ –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ (–±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –∫—Ä–∞—Å–Ω—ã–π –º–∏–Ω—É—Å)
                const isEmptyValue = !sku.value || sku.value.trim() === '';
                
                if (sku.hasFill) {
                    fillStatus = '–ü–ª–∞–Ω–æ–≤—ã–π MML';
                    // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ (–±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –∫—Ä–∞—Å–Ω—ã–π –º–∏–Ω—É—Å), –¥–µ–ª–∞–µ–º —Å—Ç–∞—Ç—É—Å –∫—Ä–∞—Å–Ω—ã–º
                    if (isEmptyValue && !sku.hasPlus) {
                        fillStatusClass = 'status-no-fill';
                    } else {
                        fillStatusClass = 'status-green-fill';
                    }
                }
                
                let valueText = sku.value || '';
                if (sku.hasPlus) {
                    valueText = '<span style="color: #28a745; font-weight: bold; font-size: 1.2em;">+</span>';
                } else if (!valueText || valueText.trim() === '') {
                    // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–Ω—ã–π –º–∏–Ω—É—Å
                    valueText = '<span style="color: #dc3545; font-weight: bold; font-size: 1.2em;">‚àí</span>';
                }
                
                row.innerHTML = `
                    <td class="sku-name">${sku.name}</td>
                    <td>
                        <span class="sku-status ${fillStatusClass}">
                            <span class="status-icon"></span>
                            ${fillStatus}
                        </span>
                    </td>
                    <td>${valueText}</td>
                `;
                skuTableBody.appendChild(row);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            document.getElementById('resultsCount').textContent = `${filteredData.length} SKU`;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const filterType = this.dataset.filter;
                applyFilter(filterType);
            });
        });

        function showFileInfo() {
            console.log('Worksheet keys:', Object.keys(worksheet).slice(0, 10));
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —è—á–µ–µ–∫ —Å—Ç–∏–ª–∏
            for (let key in worksheet) {
                if (key.startsWith('!')) continue;
                const cell = worksheet[key];
                if (cell && cell.s) {
                    console.log('–Ø—á–µ–π–∫–∞ —Å —Å—Ç–∏–ª—è–º–∏:', key, cell);
                    break;
                }
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
